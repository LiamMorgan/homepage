name: Sync Fork With Upstream

on:
  schedule:
    - cron: "0 0 * * *" # Daily at midnight UTC
  workflow_dispatch: # Manual trigger

permissions:
  contents: write

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout your fork
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Add upstream remote (parent repo)
        run: |
          git remote add upstream https://github.com/gethomepage/homepage.git
          git fetch upstream --prune

      #####################################################
      # Sync MAIN
      #####################################################
      - name: Fast-forward main from upstream/main
        continue-on-error: true
        run: |
          if git rev-parse --verify upstream/main >/dev/null 2>&1; then
            git checkout main
            git merge upstream/main --ff-only || echo "main already up to date"
          else
            echo "Upstream main not found"
          fi

      - name: Push updated main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git push origin main || echo "Nothing to push for main"

      #####################################################
      # Sync DEV
      #####################################################
      - name: Fast-forward dev from upstream/dev
        continue-on-error: true
        run: |
          if git rev-parse --verify upstream/dev >/dev/null 2>&1; then
            git checkout dev
            git merge upstream/dev --ff-only || echo "dev already up to date"
          else
            echo "Upstream dev branch does not exist. Skipping."
          fi

      - name: Push updated dev
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git push origin dev || echo "Nothing to push for dev"
